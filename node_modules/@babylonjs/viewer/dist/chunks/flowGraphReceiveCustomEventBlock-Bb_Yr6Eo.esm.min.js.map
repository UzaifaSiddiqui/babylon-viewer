{"version":3,"file":"flowGraphReceiveCustomEventBlock-Bb_Yr6Eo.esm.min.js","sources":["../../../../../dev/core/dist/FlowGraph/Blocks/Event/flowGraphReceiveCustomEventBlock.js"],"sourcesContent":["import { FlowGraphEventBlock } from \"../../flowGraphEventBlock\";\nimport { Tools } from \"../../../Misc/tools\";\nimport { RegisterClass } from \"../../../Misc/typeStore\";\nimport { FlowGraphCoordinator } from \"core/FlowGraph/flowGraphCoordinator\";\n/**\n * A block that receives a custom event.\n * It saves the event data in the data outputs, based on the provided eventData in the configuration. For example, if the event data is\n * `{ x: { type: RichTypeNumber }, y: { type: RichTypeNumber } }`, the block will have two data outputs: x and y.\n */\nexport class FlowGraphReceiveCustomEventBlock extends FlowGraphEventBlock {\n    constructor(\n    /**\n     * the configuration of the block\n     */\n    config) {\n        super(config);\n        this.config = config;\n        this.initPriority = 1;\n        // use event data to register data outputs\n        for (const key in this.config.eventData) {\n            this.registerDataOutput(key, this.config.eventData[key].type);\n        }\n    }\n    _preparePendingTasks(context) {\n        const observable = context.configuration.coordinator.getCustomEventObservable(this.config.eventId);\n        // check if we are not exceeding the max number of events\n        if (observable && observable.hasObservers() && observable.observers.length > FlowGraphCoordinator.MaxEventsPerType) {\n            this._reportError(context, `FlowGraphReceiveCustomEventBlock: Too many observers for event ${this.config.eventId}. Max is ${FlowGraphCoordinator.MaxEventsPerType}.`);\n            return;\n        }\n        const eventObserver = observable.add((eventData) => {\n            const keys = Object.keys(eventData);\n            for (const key of keys) {\n                this.getDataOutput(key)?.setValue(eventData[key], context);\n            }\n            this._execute(context);\n        });\n        context._setExecutionVariable(this, \"_eventObserver\", eventObserver);\n    }\n    _cancelPendingTasks(context) {\n        const observable = context.configuration.coordinator.getCustomEventObservable(this.config.eventId);\n        if (observable) {\n            const eventObserver = context._getExecutionVariable(this, \"_eventObserver\", null);\n            observable.remove(eventObserver);\n        }\n        else {\n            Tools.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`);\n        }\n    }\n    _executeEvent(_context, _payload) {\n        return true;\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphReceiveCustomEventBlock\" /* FlowGraphBlockNames.ReceiveCustomEvent */;\n    }\n}\nRegisterClass(\"FlowGraphReceiveCustomEventBlock\" /* FlowGraphBlockNames.ReceiveCustomEvent */, FlowGraphReceiveCustomEventBlock);\n//# sourceMappingURL=flowGraphReceiveCustomEventBlock.js.map"],"names":["FlowGraphReceiveCustomEventBlock","FlowGraphEventBlock","constructor","config","super","this","initPriority","key","eventData","registerDataOutput","type","_preparePendingTasks","context","observable","configuration","coordinator","getCustomEventObservable","eventId","hasObservers","observers","length","FlowGraphCoordinator","MaxEventsPerType","_reportError","eventObserver","add","keys","Object","getDataOutput","setValue","_execute","_setExecutionVariable","_cancelPendingTasks","_getExecutionVariable","remove","Tools","Warn","_executeEvent","_context","_payload","getClassName","RegisterClass"],"mappings":"2NASO,MAAMA,UAAyCC,EAClD,WAAAC,CAIAC,GACIC,MAAMD,GACNE,KAAKF,OAASA,EACdE,KAAKC,aAAe,EAEpB,IAAK,MAAMC,KAAOF,KAAKF,OAAOK,UAC1BH,KAAKI,mBAAmBF,EAAKF,KAAKF,OAAOK,UAAUD,GAAKG,KAEpE,CACI,oBAAAC,CAAqBC,GACjB,MAAMC,EAAaD,EAAQE,cAAcC,YAAYC,yBAAyBX,KAAKF,OAAOc,SAE1F,GAAIJ,GAAcA,EAAWK,gBAAkBL,EAAWM,UAAUC,OAASC,EAAqBC,iBAE9F,YADAjB,KAAKkB,aAAaX,EAAS,kEAAkEP,KAAKF,OAAOc,mBAAmBI,EAAqBC,qBAGrJ,MAAME,EAAgBX,EAAWY,KAAKjB,IAClC,MAAMkB,EAAOC,OAAOD,KAAKlB,GACzB,IAAK,MAAMD,KAAOmB,EACdrB,KAAKuB,cAAcrB,IAAMsB,SAASrB,EAAUD,GAAMK,GAEtDP,KAAKyB,SAASlB,MAElBA,EAAQmB,sBAAsB1B,KAAM,iBAAkBmB,EAC9D,CACI,mBAAAQ,CAAoBpB,GAChB,MAAMC,EAAaD,EAAQE,cAAcC,YAAYC,yBAAyBX,KAAKF,OAAOc,SAC1F,GAAIJ,EAAY,CACZ,MAAMW,EAAgBZ,EAAQqB,sBAAsB5B,KAAM,iBAAkB,MAC5EQ,EAAWqB,OAAOV,EAC9B,MAEYW,EAAMC,KAAK,kEAAkE/B,KAAKF,OAAOc,UAErG,CACI,aAAAoB,CAAcC,EAAUC,GACpB,OAAO,CACf,CAII,YAAAC,GACI,MAAO,kCACf,EAEAC,EAAc,mCAAiFzC"}