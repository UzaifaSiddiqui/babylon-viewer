{"version":3,"file":"flowGraphReceiveCustomEventBlock-MyXLBXXh.esm.js","sources":["../../../../../dev/core/dist/FlowGraph/Blocks/Event/flowGraphReceiveCustomEventBlock.js"],"sourcesContent":["import { FlowGraphEventBlock } from \"../../flowGraphEventBlock\";\nimport { Tools } from \"../../../Misc/tools\";\nimport { RegisterClass } from \"../../../Misc/typeStore\";\nimport { FlowGraphCoordinator } from \"core/FlowGraph/flowGraphCoordinator\";\n/**\n * A block that receives a custom event.\n * It saves the event data in the data outputs, based on the provided eventData in the configuration. For example, if the event data is\n * `{ x: { type: RichTypeNumber }, y: { type: RichTypeNumber } }`, the block will have two data outputs: x and y.\n */\nexport class FlowGraphReceiveCustomEventBlock extends FlowGraphEventBlock {\n    constructor(\n    /**\n     * the configuration of the block\n     */\n    config) {\n        super(config);\n        this.config = config;\n        this.initPriority = 1;\n        // use event data to register data outputs\n        for (const key in this.config.eventData) {\n            this.registerDataOutput(key, this.config.eventData[key].type);\n        }\n    }\n    _preparePendingTasks(context) {\n        const observable = context.configuration.coordinator.getCustomEventObservable(this.config.eventId);\n        // check if we are not exceeding the max number of events\n        if (observable && observable.hasObservers() && observable.observers.length > FlowGraphCoordinator.MaxEventsPerType) {\n            this._reportError(context, `FlowGraphReceiveCustomEventBlock: Too many observers for event ${this.config.eventId}. Max is ${FlowGraphCoordinator.MaxEventsPerType}.`);\n            return;\n        }\n        const eventObserver = observable.add((eventData) => {\n            const keys = Object.keys(eventData);\n            for (const key of keys) {\n                this.getDataOutput(key)?.setValue(eventData[key], context);\n            }\n            this._execute(context);\n        });\n        context._setExecutionVariable(this, \"_eventObserver\", eventObserver);\n    }\n    _cancelPendingTasks(context) {\n        const observable = context.configuration.coordinator.getCustomEventObservable(this.config.eventId);\n        if (observable) {\n            const eventObserver = context._getExecutionVariable(this, \"_eventObserver\", null);\n            observable.remove(eventObserver);\n        }\n        else {\n            Tools.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`);\n        }\n    }\n    _executeEvent(_context, _payload) {\n        return true;\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphReceiveCustomEventBlock\" /* FlowGraphBlockNames.ReceiveCustomEvent */;\n    }\n}\nRegisterClass(\"FlowGraphReceiveCustomEventBlock\" /* FlowGraphBlockNames.ReceiveCustomEvent */, FlowGraphReceiveCustomEventBlock);\n//# sourceMappingURL=flowGraphReceiveCustomEventBlock.js.map"],"names":[],"mappings":";;;;;AAIA;AACA;AACA;AACA;AACA;AACO,MAAM,gCAAgC,SAAS,mBAAmB,CAAC;AAC1E,IAAI,WAAW;AACf;AACA;AACA;AACA,IAAI,MAAM,EAAE;AACZ,QAAQ,KAAK,CAAC,MAAM,CAAC;AACrB,QAAQ,IAAI,CAAC,MAAM,GAAG,MAAM;AAC5B,QAAQ,IAAI,CAAC,YAAY,GAAG,CAAC;AAC7B;AACA,QAAQ,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE;AACjD,YAAY,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;AACzE;AACA;AACA,IAAI,oBAAoB,CAAC,OAAO,EAAE;AAClC,QAAQ,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,WAAW,CAAC,wBAAwB,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;AAC1G;AACA,QAAQ,IAAI,UAAU,IAAI,UAAU,CAAC,YAAY,EAAE,IAAI,UAAU,CAAC,SAAS,CAAC,MAAM,GAAG,oBAAoB,CAAC,gBAAgB,EAAE;AAC5H,YAAY,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,+DAA+D,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,EAAE,oBAAoB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;AACjL,YAAY;AACZ;AACA,QAAQ,MAAM,aAAa,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,SAAS,KAAK;AAC5D,YAAY,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;AAC/C,YAAY,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;AACpC,gBAAgB,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,OAAO,CAAC;AAC1E;AACA,YAAY,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;AAClC,SAAS,CAAC;AACV,QAAQ,OAAO,CAAC,qBAAqB,CAAC,IAAI,EAAE,gBAAgB,EAAE,aAAa,CAAC;AAC5E;AACA,IAAI,mBAAmB,CAAC,OAAO,EAAE;AACjC,QAAQ,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,WAAW,CAAC,wBAAwB,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;AAC1G,QAAQ,IAAI,UAAU,EAAE;AACxB,YAAY,MAAM,aAAa,GAAG,OAAO,CAAC,qBAAqB,CAAC,IAAI,EAAE,gBAAgB,EAAE,IAAI,CAAC;AAC7F,YAAY,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC;AAC5C;AACA,aAAa;AACb,YAAY,KAAK,CAAC,IAAI,CAAC,CAAC,+DAA+D,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;AAC/G;AACA;AACA,IAAI,aAAa,CAAC,QAAQ,EAAE,QAAQ,EAAE;AACtC,QAAQ,OAAO,IAAI;AACnB;AACA;AACA;AACA;AACA,IAAI,YAAY,GAAG;AACnB,QAAQ,OAAO,kCAAkC;AACjD;AACA;AACA,aAAa,CAAC,kCAAkC,+CAA+C,gCAAgC,CAAC;;;;"}