{"version":3,"file":"KHR_node_hoverability-nJK-yNEA.esm.js","sources":["../../../../../dev/loaders/dist/glTF/2.0/Extensions/KHR_node_hoverability.js"],"sourcesContent":["import { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry\";\nimport { addNewInteractivityFlowGraphMapping } from \"./KHR_interactivity/declarationMapper\";\nimport { AddObjectAccessorToKey } from \"./objectModelMapping\";\nconst NAME = \"KHR_node_hoverability\";\n// interactivity\nconst MeshPointerOverPrefix = \"targetMeshPointerOver_\";\naddNewInteractivityFlowGraphMapping(\"event/onHoverIn\", NAME, {\n    // using GetVariable as the nodeIndex is a configuration and not a value (i.e. it's not mutable)\n    blocks: [\"FlowGraphPointerOverEventBlock\" /* FlowGraphBlockNames.PointerOverEvent */, \"FlowGraphGetVariableBlock\" /* FlowGraphBlockNames.GetVariable */, \"FlowGraphIndexOfBlock\" /* FlowGraphBlockNames.IndexOf */, \"KHR_interactivity/FlowGraphGLTFDataProvider\"],\n    configuration: {\n        stopPropagation: { name: \"stopPropagation\" },\n        nodeIndex: {\n            name: \"variable\",\n            toBlock: \"FlowGraphGetVariableBlock\" /* FlowGraphBlockNames.GetVariable */,\n            dataTransformer(data) {\n                return [MeshPointerOverPrefix + data[0]];\n            },\n        },\n    },\n    outputs: {\n        values: {\n            hoverNodeIndex: { name: \"index\", toBlock: \"FlowGraphIndexOfBlock\" /* FlowGraphBlockNames.IndexOf */ },\n            controllerIndex: { name: \"pointerId\" },\n        },\n        flows: {\n            out: { name: \"done\" },\n        },\n    },\n    interBlockConnectors: [\n        {\n            input: \"targetMesh\",\n            output: \"value\",\n            inputBlockIndex: 0,\n            outputBlockIndex: 1,\n            isVariable: true,\n        },\n        {\n            input: \"array\",\n            output: \"nodes\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 3,\n            isVariable: true,\n        },\n        {\n            input: \"object\",\n            output: \"meshUnderPointer\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 0,\n            isVariable: true,\n        },\n    ],\n    extraProcessor(gltfBlock, _declaration, _mapping, _arrays, serializedObjects, context, globalGLTF) {\n        // add the glTF to the configuration of the last serialized object\n        const serializedObject = serializedObjects[serializedObjects.length - 1];\n        serializedObject.config = serializedObject.config || {};\n        serializedObject.config.glTF = globalGLTF;\n        // find the listener nodeIndex value\n        const nodeIndex = gltfBlock.configuration?.[\"nodeIndex\"]?.value[0];\n        if (nodeIndex === undefined || typeof nodeIndex !== \"number\") {\n            throw new Error(\"nodeIndex not found in configuration\");\n        }\n        const variableName = MeshPointerOverPrefix + nodeIndex;\n        // find the nodeIndex value\n        serializedObjects[1].config.variable = variableName;\n        context._userVariables[variableName] = {\n            className: \"Mesh\",\n            id: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.id,\n            uniqueId: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.uniqueId,\n        };\n        return serializedObjects;\n    },\n});\nconst MeshPointerOutPrefix = \"targetMeshPointerOut_\";\naddNewInteractivityFlowGraphMapping(\"event/onHoverOut\", NAME, {\n    // using GetVariable as the nodeIndex is a configuration and not a value (i.e. it's not mutable)\n    blocks: [\"FlowGraphPointerOutEventBlock\" /* FlowGraphBlockNames.PointerOutEvent */, \"FlowGraphGetVariableBlock\" /* FlowGraphBlockNames.GetVariable */, \"FlowGraphIndexOfBlock\" /* FlowGraphBlockNames.IndexOf */, \"KHR_interactivity/FlowGraphGLTFDataProvider\"],\n    configuration: {\n        stopPropagation: { name: \"stopPropagation\" },\n        nodeIndex: {\n            name: \"variable\",\n            toBlock: \"FlowGraphGetVariableBlock\" /* FlowGraphBlockNames.GetVariable */,\n            dataTransformer(data) {\n                return [MeshPointerOutPrefix + data[0]];\n            },\n        },\n    },\n    outputs: {\n        values: {\n            hoverNodeIndex: { name: \"index\", toBlock: \"FlowGraphIndexOfBlock\" /* FlowGraphBlockNames.IndexOf */ },\n            controllerIndex: { name: \"pointerId\" },\n        },\n        flows: {\n            out: { name: \"done\" },\n        },\n    },\n    interBlockConnectors: [\n        {\n            input: \"targetMesh\",\n            output: \"value\",\n            inputBlockIndex: 0,\n            outputBlockIndex: 1,\n            isVariable: true,\n        },\n        {\n            input: \"array\",\n            output: \"nodes\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 3,\n            isVariable: true,\n        },\n        {\n            input: \"object\",\n            output: \"meshOutOfPointer\",\n            inputBlockIndex: 2,\n            outputBlockIndex: 0,\n            isVariable: true,\n        },\n    ],\n    extraProcessor(gltfBlock, _declaration, _mapping, _arrays, serializedObjects, context, globalGLTF) {\n        // add the glTF to the configuration of the last serialized object\n        const serializedObject = serializedObjects[serializedObjects.length - 1];\n        serializedObject.config = serializedObject.config || {};\n        serializedObject.config.glTF = globalGLTF;\n        const nodeIndex = gltfBlock.configuration?.[\"nodeIndex\"]?.value[0];\n        if (nodeIndex === undefined || typeof nodeIndex !== \"number\") {\n            throw new Error(\"nodeIndex not found in configuration\");\n        }\n        const variableName = MeshPointerOutPrefix + nodeIndex;\n        // find the nodeIndex value\n        serializedObjects[1].config.variable = variableName;\n        context._userVariables[variableName] = {\n            className: \"Mesh\",\n            id: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.id,\n            uniqueId: globalGLTF?.nodes?.[nodeIndex]._babylonTransformNode?.uniqueId,\n        };\n        return serializedObjects;\n    },\n});\nAddObjectAccessorToKey(\"/nodes/{}/extensions/KHR_node_hoverability/hoverable\", {\n    get: (node) => {\n        const tn = node._babylonTransformNode;\n        if (tn && tn.pointerOverDisableMeshTesting !== undefined) {\n            return tn.pointerOverDisableMeshTesting;\n        }\n        return true;\n    },\n    set: (value, node) => {\n        node._primitiveBabylonMeshes?.forEach((mesh) => {\n            mesh.pointerOverDisableMeshTesting = !value;\n        });\n    },\n    getTarget: (node) => node._babylonTransformNode,\n    getPropertyName: [() => \"pointerOverDisableMeshTesting\"],\n    type: \"boolean\",\n});\n/**\n * Loader extension for KHR_node_hoverability\n * @see https://github.com/KhronosGroup/glTF/pull/2426\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class KHR_node_hoverability {\n    /**\n     * @internal\n     */\n    constructor(loader) {\n        /**\n         * The name of this extension.\n         */\n        this.name = NAME;\n        this._loader = loader;\n        this.enabled = loader.isExtensionUsed(NAME);\n    }\n    // eslint-disable-next-line @typescript-eslint/naming-convention, @typescript-eslint/no-misused-promises\n    async onReady() {\n        this._loader.gltf.nodes?.forEach((node) => {\n            // default is true, so only apply if false\n            if (node.extensions?.KHR_node_hoverability && node.extensions?.KHR_node_hoverability.hoverable === false) {\n                node._babylonTransformNode?.getChildMeshes().forEach((mesh) => {\n                    mesh.pointerOverDisableMeshTesting = true;\n                });\n            }\n        });\n    }\n    dispose() {\n        this._loader = null;\n    }\n}\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new KHR_node_hoverability(loader));\n//# sourceMappingURL=KHR_node_hoverability.js.map"],"names":[],"mappings":"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"}