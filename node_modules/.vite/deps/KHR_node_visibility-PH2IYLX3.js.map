{
  "version": 3,
  "sources": ["../../../dev/loaders/src/glTF/2.0/Extensions/KHR_node_visibility.ts"],
  "sourcesContent": ["import type { AbstractMesh } from \"core/Meshes/abstractMesh\";\nimport type { GLTFLoader } from \"../glTFLoader\";\nimport type { IGLTFLoaderExtension } from \"../glTFLoaderExtension\";\nimport { registerGLTFExtension, unregisterGLTFExtension } from \"../glTFLoaderExtensionRegistry\";\nimport type { INode } from \"../glTFLoaderInterfaces\";\nimport { AddObjectAccessorToKey } from \"./objectModelMapping\";\n\nconst NAME = \"KHR_node_visibility\";\n\ndeclare module \"../../glTFFileLoader\" {\n    // eslint-disable-next-line jsdoc/require-jsdoc, @typescript-eslint/naming-convention\n    export interface GLTFLoaderExtensionOptions {\n        /**\n         * Defines options for the KHR_node_visibility extension.\n         */\n        // NOTE: Don't use NAME here as it will break the UMD type declarations.\n        [\"KHR_node_visibility\"]: {};\n    }\n}\n\n// object model extension for visibility\nAddObjectAccessorToKey(\"/nodes/{}/extensions/KHR_node_visibility/visible\", {\n    get: (node: INode) => {\n        const tn = node._babylonTransformNode as any;\n        if (tn && tn.isVisible !== undefined) {\n            return tn.isVisible;\n        }\n        return true;\n    },\n    set: (value: boolean, node: INode) => {\n        node._primitiveBabylonMeshes?.forEach((mesh) => {\n            mesh.inheritVisibility = true;\n        });\n        if (node._babylonTransformNode) {\n            (node._babylonTransformNode as AbstractMesh).isVisible = value;\n        }\n        node._primitiveBabylonMeshes?.forEach((mesh) => {\n            mesh.isVisible = value;\n        });\n    },\n    getTarget: (node: INode) => node._babylonTransformNode,\n    getPropertyName: [() => \"isVisible\"],\n    type: \"boolean\",\n});\n\n/**\n * Loader extension for KHR_node_visibility\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class KHR_node_visibility implements IGLTFLoaderExtension {\n    /**\n     * The name of this extension.\n     */\n    public readonly name = NAME;\n    /**\n     * Defines whether this extension is enabled.\n     */\n    public enabled: boolean;\n\n    private _loader: GLTFLoader;\n\n    /**\n     * @internal\n     */\n    constructor(loader: GLTFLoader) {\n        this._loader = loader;\n        this.enabled = loader.isExtensionUsed(NAME);\n    }\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention, @typescript-eslint/no-misused-promises\n    public async onReady(): Promise<void> {\n        this._loader.gltf.nodes?.forEach((node) => {\n            node._primitiveBabylonMeshes?.forEach((mesh) => {\n                mesh.inheritVisibility = true;\n            });\n            // When the JSON Pointer is used we need to change both the transform node and the primitive meshes to the new value.\n            if (node.extensions?.KHR_node_visibility) {\n                if (node.extensions?.KHR_node_visibility.visible === false) {\n                    if (node._babylonTransformNode) {\n                        (node._babylonTransformNode as AbstractMesh).isVisible = false;\n                    }\n                    node._primitiveBabylonMeshes?.forEach((mesh) => {\n                        mesh.isVisible = false;\n                    });\n                }\n            }\n        });\n    }\n\n    public dispose() {\n        (this._loader as any) = null;\n    }\n}\n\nunregisterGLTFExtension(NAME);\nregisterGLTFExtension(NAME, true, (loader) => new KHR_node_visibility(loader));\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,IAAM,OAAO;AAcb,uBAAuB,oDAAoD;EACvE,KAAK,CAAC,SAAe;AACjB,UAAM,KAAK,KAAK;AAChB,QAAI,MAAM,GAAG,cAAc,QAAW;AAClC,aAAO,GAAG;IACd;AACA,WAAO;EACX;EACA,KAAK,CAAC,OAAgB,SAAe;AA1BzC;AA2BQ,eAAK,4BAAL,mBAA8B,QAAQ,CAAC,SAAQ;AAC3C,WAAK,oBAAoB;IAC7B;AACA,QAAI,KAAK,uBAAuB;AAC3B,WAAK,sBAAuC,YAAY;IAC7D;AACA,eAAK,4BAAL,mBAA8B,QAAQ,CAAC,SAAQ;AAC3C,WAAK,YAAY;IACrB;EACJ;EACA,WAAW,CAAC,SAAgB,KAAK;EACjC,iBAAiB,CAAC,MAAM,WAAW;EACnC,MAAM;CACT;AAMK,IAAO,sBAAP,MAA0B;;;;EAe5B,YAAY,QAAkB;AAXd,SAAA,OAAO;AAYnB,SAAK,UAAU;AACf,SAAK,UAAU,OAAO,gBAAgB,IAAI;EAC9C;;EAGO,MAAM,UAAO;AAnExB;AAoEQ,eAAK,QAAQ,KAAK,UAAlB,mBAAyB,QAAQ,CAAC,SAAQ;AApElD,UAAAA,KAAA;AAqEY,OAAAA,MAAA,KAAK,4BAAL,gBAAAA,IAA8B,QAAQ,CAAC,SAAQ;AAC3C,aAAK,oBAAoB;MAC7B;AAEA,WAAI,UAAK,eAAL,mBAAiB,qBAAqB;AACtC,cAAI,UAAK,eAAL,mBAAiB,oBAAoB,aAAY,OAAO;AACxD,cAAI,KAAK,uBAAuB;AAC3B,iBAAK,sBAAuC,YAAY;UAC7D;AACA,qBAAK,4BAAL,mBAA8B,QAAQ,CAAC,SAAQ;AAC3C,iBAAK,YAAY;UACrB;QACJ;MACJ;IACJ;EACJ;EAEO,UAAO;AACT,SAAK,UAAkB;EAC5B;;AAGJ,wBAAwB,IAAI;AAC5B,sBAAsB,MAAM,MAAM,CAAC,WAAW,IAAI,oBAAoB,MAAM,CAAC;",
  "names": ["_a"]
}
