import{aq as p,V as o,aP as L,aQ as u,aR as A,ak as c,a4 as m,a3 as f}from"./index-73dd56e2.js";import{A as _,G as g}from"./glTFLoader-f013e480.js";import"./objectModelMapping-97792a33.js";const s="KHR_lights_punctual";class w{constructor(n){this.name=s,this._loader=n,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.gltf.extensions;if(n&&n[this.name]){const i=n[this.name];this._lights=i.lights,_.Assign(this._lights)}}loadNodeAsync(n,i,b){return g.LoadExtensionAsync(n,i,this.name,async(l,y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(n,i,r=>{let e;const t=_.Get(l,this._lights,y.light),h=t.name||r.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t.type){case"directional":{const a=new u(h,o.Backward(),this._loader.babylonScene);a.position.setAll(0),e=a;break}case"point":{e=new L(h,o.Zero(),this._loader.babylonScene);break}case"spot":{const a=new p(h,o.Zero(),o.Backward(),0,1,this._loader.babylonScene);a.angle=(t.spot&&t.spot.outerConeAngle||Math.PI/4)*2,a.innerAngle=(t.spot&&t.spot.innerConeAngle||0)*2,e=a;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${t.type})`)}e._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=e,e.falloffType=A.FALLOFF_GLTF,e.diffuse=t.color?c.FromArray(t.color):c.White(),e.intensity=t.intensity==null?1:t.intensity,e.range=t.range==null?Number.MAX_VALUE:t.range,e.parent=r,this._loader._babylonLights.push(e),g.AddPointerMetadata(e,l),b(r)})))}}m(s);f(s,!0,d=>new w(d));export{w as KHR_lights};
