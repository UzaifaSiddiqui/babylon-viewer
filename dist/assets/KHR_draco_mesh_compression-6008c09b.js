import{aH as O,a4 as A,a3 as E,ah as o}from"./index-73dd56e2.js";import{G as I,A as f,L as D}from"./glTFLoader-f013e480.js";import"./objectModelMapping-97792a33.js";const l="KHR_draco_mesh_compression";class G{constructor(a){this.name=l,this.useNormalizedFlagFromAccessor=!0,this._loader=a,this.enabled=O.DefaultAvailable&&this._loader.isExtensionUsed(l)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(a,r,s){return I.LoadExtensionAsync(a,r,this.name,async(T,_)=>{if(r.mode!=null&&r.mode!==4&&r.mode!==5)throw new Error(`${a}: Unsupported mode ${r.mode}`);const m={},h={},e=(i,t)=>{const d=_.attributes[i];if(d!=null&&(s._delayInfo=s._delayInfo||[],s._delayInfo.indexOf(t)===-1&&s._delayInfo.push(t),m[t]=d,this.useNormalizedFlagFromAccessor)){const c=f.TryGet(this._loader.gltf.accessors,r.attributes[i]);c&&(h[t]=c.normalized||!1)}};e("POSITION",o.PositionKind),e("NORMAL",o.NormalKind),e("TANGENT",o.TangentKind),e("TEXCOORD_0",o.UVKind),e("TEXCOORD_1",o.UV2Kind),e("TEXCOORD_2",o.UV3Kind),e("TEXCOORD_3",o.UV4Kind),e("TEXCOORD_4",o.UV5Kind),e("TEXCOORD_5",o.UV6Kind),e("JOINTS_0",o.MatricesIndicesKind),e("WEIGHTS_0",o.MatricesWeightsKind),e("COLOR_0",o.ColorKind);const n=f.Get(T,this._loader.gltf.bufferViews,_.bufferView);return n._dracoBabylonGeometry||(n._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then(async i=>{const t=this.dracoDecoder||O.Default,d=f.TryGet(this._loader.gltf.accessors,r.attributes.POSITION),c=!this._loader.parent.alwaysComputeBoundingBox&&!s.skeleton&&d?D(d):null;return await t._decodeMeshToGeometryForGltfAsync(s.name,this._loader.babylonScene,i,m,h,c).catch(y=>{throw new Error(`${a}: ${y.message}`)})})),await n._dracoBabylonGeometry})}}A(l);E(l,!0,u=>new G(u));export{G as KHR_draco_mesh_compression};
